#!/usr/bin/env ruby

$:.unshift File.dirname(__FILE__) + "/../lib"
begin
  require "hector"
  require "logger"
rescue LoadError => e
  if require "rubygems"
    retry
  else
    raise e
  end
end

EventMachine.run do
  identity_filename = ARGV.first || File.dirname(__FILE__) + "/../config/identities.yml"
  Hector::Identity.adapter = YamlIdentityAdapter.new(identity_filename)

  Hector.logger = Logger.new($stderr)
  Hector.logger.datetime_format = "%Y-%m-%d %H:%M:%S"

  Hector.start_server
end
